<html>
<head>
<title>Trivia Party!</title>
<script src="/socket.io/socket.io.js"></script>
<script>
var socket = io.connect('http://localhost');

var answers = [];
var hintTimer;

var stopTimer = function() {
	clearTimeout(hintTimer);
	hintTimer = null;
}

var hintTick = function() {
	if (hintTimer != null) {
		var hint = document.getElementById('hint');
		var hintText = hint.innerHTML;
		var newHint = hintText;
		while (newHint === hintText && hintText !== answers[0]) {
			var replacementPoint = Math.floor(Math.random() * hintText.length);
			newHint = newHint.substr(0, replacementPoint) + answers[0].substr(replacementPoint, 1) + newHint.substr(replacementPoint+1);
		}
		hint.innerHTML = newHint;
		hintTimer = setTimeout("hintTick()", 1500);
	}
}

socket.on('gotquestion', function (data) {
	document.getElementById('question').innerHTML = data.question.toString();
	answers = data.answers;
	document.getElementById('guess').value = "";
	document.getElementById('guess').focus();
	document.getElementById('hint').innerHTML = answers[0].replace(/[A-Z]/gi, '_')
	stopTimer();
	hintTimer = setTimeout("hintTick()", 3000);
});

socket.on('gottext', function(data) {
	document.getElementById('text').innerHTML += data.text + '<br/>';
});

socket.on('gotitright', function(data) {
	alert('correct!');
});

var guesstextentered = function(e, element) {
	var key=e.keyCode || e.which;
	if (key == 13 && element.value != "") {
		socket.emit('userguess', { guess: element.value});
	}
}
</script>
</head>
<style>
#hint {
	font-family: monospace;
	letter-spacing: 0.5em;
}
</style>
<body>
<span id="question">Loading question...</span><p/>
<span id="hint"></span><p/>
<input id="guess" type="text" onkeypress="guesstextentered(event, this)" default="true" /><p/>
<span id="text"></span>
</body>
